<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Mobile Test - Area22</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
        }
        button {
            background: #00ff00;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            min-height: 44px; /* iOS touch target */
        }
        button:hover {
            background: #00cc00;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        .device-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📱 Mobile Test - Area22</h1>
        <p>This page tests mobile functionality for the DJ dashboard.</p>
        
        <!-- Device Info -->
        <div class="device-info" id="deviceInfo">
            Loading device information...
        </div>
        
        <!-- Connection Test -->
        <div class="test-section">
            <h3>1. Connection Test</h3>
            <button onclick="testConnection()">Test Supabase Connection</button>
            <button onclick="testNetwork()">Test Network</button>
            <div id="connectionStatus"></div>
        </div>
        
        <!-- JavaScript Test -->
        <div class="test-section">
            <h3>2. JavaScript Test</h3>
            <button onclick="testJavaScript()">Test JavaScript Features</button>
            <button onclick="testTouch()">Test Touch Events</button>
            <div id="jsStatus"></div>
        </div>
        
        <!-- Dashboard Test -->
        <div class="test-section">
            <h3>3. Dashboard Test</h3>
            <button onclick="testDashboard()">Test Dashboard Load</button>
            <button onclick="openDashboard()">Open DJ Dashboard</button>
            <div id="dashboardStatus"></div>
        </div>
        
        <!-- Log -->
        <div class="test-section">
            <h3>4. Debug Log</h3>
            <button onclick="clearLog()">Clear Log</button>
            <div id="log" class="log"></div>
        </div>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function showStatus(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateDeviceInfo() {
            const info = document.getElementById('deviceInfo');
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isAndroid = /Android/.test(userAgent);
            
            info.innerHTML = `
                <strong>Device Information:</strong><br>
                Mobile: ${isMobile ? 'Yes' : 'No'}<br>
                iOS: ${isIOS ? 'Yes' : 'No'}<br>
                Android: ${isAndroid ? 'Yes' : 'No'}<br>
                Screen: ${window.innerWidth}x${window.innerHeight}<br>
                Touch: ${'ontouchstart' in window ? 'Yes' : 'No'}<br>
                User Agent: ${userAgent}
            `;
            
            log(`Device detected: ${isMobile ? 'Mobile' : 'Desktop'} - ${isIOS ? 'iOS' : isAndroid ? 'Android' : 'Other'}`, 'info');
        }
        
        async function testConnection() {
            log('Testing Supabase connection...', 'info');
            try {
                const { data, error } = await supabase
                    .from('song_requests')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    log(`Connection failed: ${error.message}`, 'error');
                    showStatus('connectionStatus', `Connection failed: ${error.message}`, 'error');
                } else {
                    log('Connection successful!', 'success');
                    showStatus('connectionStatus', 'Supabase connection successful!', 'success');
                }
            } catch (err) {
                log(`Connection error: ${err.message}`, 'error');
                showStatus('connectionStatus', `Connection error: ${err.message}`, 'error');
            }
        }
        
        async function testNetwork() {
            log('Testing network connectivity...', 'info');
            try {
                const response = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    timeout: 5000
                });
                
                if (response.ok) {
                    log('Network test successful!', 'success');
                    showStatus('connectionStatus', 'Network connectivity OK!', 'success');
                } else {
                    log(`Network test failed: ${response.status}`, 'error');
                    showStatus('connectionStatus', `Network test failed: ${response.status}`, 'error');
                }
            } catch (err) {
                log(`Network error: ${err.message}`, 'error');
                showStatus('connectionStatus', `Network error: ${err.message}`, 'error');
            }
        }
        
        function testJavaScript() {
            log('Testing JavaScript features...', 'info');
            const features = {
                'localStorage': typeof(Storage) !== "undefined",
                'sessionStorage': typeof(Storage) !== "undefined",
                'fetch': typeof fetch !== 'undefined',
                'promises': typeof Promise !== 'undefined',
                'async/await': (async () => {}).constructor.name === 'AsyncFunction',
                'arrow functions': (() => {}).constructor.name === 'Function',
                'template literals': `test`.includes('test'),
                'supabase': typeof supabase !== 'undefined'
            };
            
            let results = [];
            for (const [feature, supported] of Object.entries(features)) {
                results.push(`${feature}: ${supported ? '✅' : '❌'}`);
                log(`${feature}: ${supported ? 'Supported' : 'Not supported'}`, supported ? 'success' : 'error');
            }
            
            const allSupported = Object.values(features).every(v => v);
            showStatus('jsStatus', `JavaScript test ${allSupported ? 'passed' : 'failed'}<br>${results.join('<br>')}`, allSupported ? 'success' : 'warning');
        }
        
        function testTouch() {
            log('Testing touch events...', 'info');
            let touchSupported = 'ontouchstart' in window;
            let touchEvents = [];
            
            document.addEventListener('touchstart', function() {
                touchEvents.push('touchstart');
                log('Touch start detected', 'success');
            });
            
            document.addEventListener('touchend', function() {
                touchEvents.push('touchend');
                log('Touch end detected', 'success');
            });
            
            if (touchSupported) {
                log('Touch events supported', 'success');
                showStatus('jsStatus', 'Touch events supported. Tap anywhere to test.', 'info');
            } else {
                log('Touch events not supported', 'warning');
                showStatus('jsStatus', 'Touch events not supported', 'warning');
            }
        }
        
        async function testDashboard() {
            log('Testing dashboard functionality...', 'info');
            try {
                // Test if we can load the dashboard content
                const response = await fetch('/dj-dashboard.html');
                if (response.ok) {
                    log('Dashboard HTML accessible', 'success');
                    
                    // Test Supabase connection specifically for dashboard
                    const { data, error } = await supabase
                        .from('song_requests')
                        .select('*')
                        .limit(1);
                    
                    if (error) {
                        log(`Dashboard Supabase test failed: ${error.message}`, 'error');
                        showStatus('dashboardStatus', `Dashboard test failed: ${error.message}`, 'error');
                    } else {
                        log('Dashboard Supabase test passed', 'success');
                        showStatus('dashboardStatus', 'Dashboard test passed! Ready to use.', 'success');
                    }
                } else {
                    log(`Dashboard HTML not accessible: ${response.status}`, 'error');
                    showStatus('dashboardStatus', `Dashboard not accessible: ${response.status}`, 'error');
                }
            } catch (err) {
                log(`Dashboard test error: ${err.message}`, 'error');
                showStatus('dashboardStatus', `Dashboard test error: ${err.message}`, 'error');
            }
        }
        
        function openDashboard() {
            log('Opening DJ dashboard...', 'info');
            window.open('/dj-dashboard.html', '_blank');
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            log('Mobile test page loaded', 'success');
            updateDeviceInfo();
            setTimeout(testConnection, 1000);
        });
        
        // Add touch event listeners for testing
        document.addEventListener('touchstart', function(e) {
            log(`Touch detected at ${e.touches[0].clientX}, ${e.touches[0].clientY}`, 'info');
        });
    </script>
</body>
</html>
